- name: Integrate SukiSU Ultra
  run: |
    cd "$CONFIG"
    
    # Download setup script
    echo "Downloading SukiSU setup script..."
    curl -LSs "https://raw.githubusercontent.com/SukiSU-Ultra/SukiSU-Ultra/main/kernel/setup.sh" -o /tmp/sukisu_setup.sh
    
    # Run setup WITHOUT 'susfs' argument (that branch doesn't exist)
    # This will use the default 'main' branch
    echo "Running SukiSU integration..."
    bash /tmp/sukisu_setup.sh
    
    # Verify integration succeeded
    if [ ! -d "KernelSU" ]; then
      echo "ERROR: KernelSU directory not found! Integration failed."
      exit 1
    fi
    
    # Check for the actual kernel integration (the symlink target)
    if [ ! -d "drivers/kernelsu" ]; then
      echo "ERROR: drivers/kernelsu not found! Integration failed."
      exit 1
    fi
    
    # Verify Makefile was modified
    if ! grep -q "kernelsu" drivers/Makefile; then
      echo "ERROR: drivers/Makefile not modified for KernelSU!"
      exit 1
    fi
    
    # Verify Kconfig was modified
    if ! grep -q "kernelsu/Kconfig" drivers/Kconfig; then
      echo "ERROR: drivers/Kconfig not modified for KernelSU!"
      exit 1
    fi
    
    echo "âœ“ SukiSU integration successful"
    echo "KernelSU directory contents:"
    ls -la KernelSU/ || echo "KernelSU dir exists but can't list"
    echo "drivers/kernelsu contents:"
    ls -la drivers/kernelsu/
    echo "Checking Kconfig files:"
    find KernelSU -name "Kconfig" -type f
